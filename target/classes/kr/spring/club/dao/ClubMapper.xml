<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper  namespace="kr.spring.club.dao.ClubMapper">
	<insert id="insertClub" parameterType="clubVO">
		insert into club
			(id,club_loc,club_name,club_detail,club_img,club_color,filename,club_age,club_locX,club_locY,club_address)
		values
			(#{id},#{club_loc},#{club_name},
		<if test="club_detail !=''">
			#{club_detail},
		</if>
		<if test="club_detail ==''">
			'',
		</if>
		<if test="club_img !=''">
			#{club_img},
		</if>
		<if test="club_img ==''">
			'',
		</if>
		<if test="club_color !=''">
			#{club_color},
		</if>
		<if test="club_color ==''">
			'',
		</if>
		<if test="filename !=''">
			#{filename},
		</if>
		<if test="filename ==''">
			'',
		</if>
		#{club_age},#{club_locX},#{club_locY},#{club_address})
		<selectKey keyProperty="club_num" resultType="integer" order="AFTER" statementType="PREPARED">
			select max(club_num) as club_num from club
		</selectKey>
	</insert>
	<select id="selectAwayDetailsForRequestedMatch" parameterType="string" resultType="clubVO">
	select * from (select e.manner manner,e.perform perform, e.rating_count rating_count,e.club_num club_num,d.acceptance acceptance,d.address address,d.type type,d.start_time start_time,d.end_time end_time,d.match_date match_date from
    	(select * from
    		(select match_num,away club_num,acceptance,request_detail from match_request ) a
    		join match b on a.match_num=b.match_num where b.match_date>sysdate-1 and b.home=#{club_num})d
    left outer join 
    	(select avg(manner) manner,avg(perform) perform,count(*) rating_count,club_num from club_rating group by club_num)e
    		 on d.club_num=e.club_num) f join club c on f.club_num=c.club_num
	</select>
	<select id="selectHomeDetailsForRequestedMatch" parameterType="string" resultType="clubVO">
	select * from (select e.manner manner,e.perform perform, e.rating_count rating_count,e.club_num club_num,d.acceptance acceptance,d.address address,d.type type,d.start_time start_time,d.end_time end_time,d.match_date match_date from
    	(select * from
    		(select match_num,away club_num,acceptance,request_detail from match_request where away=#{club_num} ) a 
    		join match b on a.match_num=b.match_num where b.match_date>sysdate-1)d
    left outer join 
    	(select avg(manner) manner,avg(perform) perform,count(*) rating_count,club_num from club_rating group by club_num)e 
    	on d.club_num=e.club_num) f join club c on f.club_num=c.club_num
	</select>
</mapper>
